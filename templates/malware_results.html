{% extends "base.html" %}

{% block title %}R√©sultats de l'analyse{% endblock %}

{% block content %}
<div class="card mb-4">
    <div class="card-header bg-warning text-dark">
        <h4>R√©sultats de l'analyse - {{ filename }}</h4>
    </div>
    <div class="card-body">
        <div class="row mb-3">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body text-center">
                        <h5 class="card-title">Niveau de menace</h5>
                        <h2 class="display-6">
                            {% if results.threat_level == 'CRITICAL' %}
                                <span class="badge bg-danger">{{ results.threat_level }}</span>
                            {% elif results.threat_level == 'HIGH' %}
                                <span class="badge bg-warning">{{ results.threat_level }}</span>
                            {% elif results.threat_level == 'MEDIUM' %}
                                <span class="badge bg-info">{{ results.threat_level }}</span>
                            {% else %}
                                <span class="badge bg-success">{{ results.threat_level }}</span>
                            {% endif %}
                        </h2>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body text-center">
                        <h5 class="card-title">D√©tections</h5>
                        <h2 class="display-6 text-warning">{{ results.detections|length }}</h2>
                        <p class="card-text">Probl√®mes trouv√©s</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-body text-center">
                        <h5 class="card-title">Taille</h5>
                        <h2 class="display-6 text-info">
                            {% if results.file_info.size > 1024*1024 %}
                                {{ "%.1f"|format(results.file_info.size / (1024*1024)) }} MB
                            {% elif results.file_info.size > 1024 %}
                                {{ "%.1f"|format(results.file_info.size / 1024) }} KB
                            {% else %}
                                {{ results.file_info.size }} bytes
                            {% endif %}
                        </h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-3">
            <div class="card-header">
                <h5>Informations du fichier</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <table class="table table-sm">
                            <tr>
                                <th>Nom :</th>
                                <td>{{ filename }}</td>
                            </tr>
                            <tr>
                                <th>Extension :</th>
                                <td>
                                    <span class="badge bg-secondary">{{ results.file_info.extension or 'Aucune' }}</span>
                                </td>
                            </tr>
                            <tr>
                                <th>Taille :</th>
                                <td>{{ results.file_info.size }} bytes</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-sm">
                            <tr>
                                <th>Hash MD5 :</th>
                                <td><code>{{ results.file_info.hash }}</code></td>
                            </tr>
                            <tr>
                                <th>Statut :</th>
                                <td>
                                    {% if results.threat_level == 'CRITICAL' %}
                                        <span class="text-danger">üö® MALWARE D√âTECT√â</span>
                                    {% elif results.threat_level == 'HIGH' %}
                                        <span class="text-warning">‚ö†Ô∏è TR√àS SUSPECT</span>
                                    {% elif results.threat_level == 'MEDIUM' %}
                                        <span class="text-info">üîç SUSPECT</span>
                                    {% else %}
                                        <span class="text-success">‚úÖ S√õR</span>
                                    {% endif %}
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        {% if results.detections %}
        <div class="card mb-3">
            <div class="card-header {% if results.threat_level == 'CRITICAL' %}bg-danger text-white{% elif results.threat_level == 'HIGH' %}bg-warning text-dark{% else %}bg-info text-white{% endif %}">
                <h5>D√©tections ({{ results.detections|length }})</h5>
            </div>
            <div class="card-body">
                {% for detection in results.detections %}
                <div class="alert {% if results.threat_level == 'CRITICAL' %}alert-danger{% elif results.threat_level == 'HIGH' %}alert-warning{% else %}alert-info{% endif %}" role="alert">
                    <i class="fas fa-exclamation-triangle"></i> {{ detection }}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <div class="card mt-3">
            <div class="card-header">
                <h5>Recommandations</h5>
            </div>
            <div class="card-body">
                {% if results.threat_level == 'CRITICAL' %}
                <div class="alert alert-danger">
                    <strong>üö® DANGER CRITIQUE :</strong>
                    <ul>
                        <li>Ne PAS ex√©cuter ce fichier</li>
                        <li>Supprimer imm√©diatement le fichier</li>
                        <li>Scanner votre syst√®me avec un antivirus</li>
                        <li>V√©rifier les autres fichiers du m√™me dossier</li>
                        <li>Changer vos mots de passe si n√©cessaire</li>
                    </ul>
                </div>
                {% elif results.threat_level == 'HIGH' %}
                <div class="alert alert-warning">
                    <strong>‚ö†Ô∏è TR√àS SUSPECT :</strong>
                    <ul>
                        <li>Ne pas ex√©cuter ce fichier</li>
                        <li>Analyser avec d'autres outils</li>
                        <li>V√©rifier la source du fichier</li>
                        <li>Placer en quarantaine</li>
                    </ul>
                </div>
                {% elif results.threat_level == 'MEDIUM' %}
                <div class="alert alert-info">
                    <strong>üîç SUSPECT :</strong>
                    <ul>
                        <li>Analyser avec prudence</li>
                        <li>V√©rifier la source</li>
                        <li>Scanner avec un antivirus</li>
                        <li>Surveiller l'activit√© syst√®me</li>
                    </ul>
                </div>
                {% else %}
                <div class="alert alert-success">
                    <strong>‚úÖ FICHIER S√õR :</strong>
                    <ul>
                        <li>Aucune menace d√©tect√©e</li>
                        <li>Le fichier semble s√ªr</li>
                        <li>Continuez la surveillance habituelle</li>
                    </ul>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="text-center">
    <a href="{{ url_for('malware_detector_page') }}" class="btn btn-warning">
        <i class="fas fa-redo"></i> Analyser un autre fichier
    </a>
    <a href="{{ url_for('index') }}" class="btn btn-secondary">
        <i class="fas fa-home"></i> Retour au dashboard
    </a>
</div>
{% endblock %}